{"version":3,"sources":["js/CETEI.js"],"names":["CETEI","base","els","behaviors","hasStyle","prefixes","window","location","href","replace","push","TEI_url","callback","promise","resolve","reject","client","XMLHttpRequest","open","send","onload","status","response","statusText","onerror","then","TEI","makeHTML5","catch","reason","console","log","TEI_dom","DOMParser","parseFromString","_fromTEI","convertEl","el","newElement","copy","namespaceURI","document","createElement","tagName","importNode","attributes","att","name","setAttribute","value","childNodes","node","nodeType","Node","ELEMENT_NODE","appendChild","cloneNode","localName","style","getAttribute","rule","hasAttribute","textContent","createTextNode","length","dom","documentElement","registerElement","registerAll","fallback","doc","data","getElementsByTagName","item","bhvs","root_el","x","add","elt","strings","createShadowRoot","shadow","innerHTML","span","includes","str","result","search","re","replacements","exec","call","ceteicean","i","_template","_insert","fn","Array","isArray","decorator","names","proto","HTMLElement","prototype","getHandler","createdCallback","prefixedName","error","getFallback","url","match","urls"],"mappings":"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","file":"js/CETEI.js","sourcesContent":["import behaviors from './behaviors'\nclass CETEI {\n\n    constructor(base){\n        this.els = [];\n        this.behaviors = [];\n        this.hasStyle = false;\n        this.prefixes = [];\n        if (base) {\n          this.base = base;\n        } else {\n          this.base = window.location.href.replace(/\\/[^\\/]*$/, \"/\");\n        }\n        this.behaviors.push(behaviors);\n    }\n\n    // public method\n    /* Returns a Promise that fetches a TEI source document from the URL\n       provided in the first parameter and then calls the makeHTML5 method\n       on the returned document.\n     */\n    getHTML5(TEI_url, callback){\n        // Get TEI from TEI_url and create a promise\n        let promise = new Promise( function (resolve, reject) {\n            let client = new XMLHttpRequest();\n\n            client.open('GET', TEI_url);\n            client.send();\n\n            client.onload = function () {\n              if (this.status >= 200 && this.status < 300) {\n                resolve(this.response);\n              } else {\n                reject(this.statusText);\n              }\n            };\n            client.onerror = function () {\n              reject(this.statusText);\n            };\n        })\n        .then((TEI) => {\n            this.makeHTML5(TEI, callback);\n        })\n        .catch( function(reason) {\n            // TODO: better error handling?\n            console.log(reason);\n        });\n\n        return promise;\n\n    }\n\n    /* Converts the supplied TEI string into HTML5 Custom Elements. If a callback\n       function is supplied, calls it on the result.\n     */\n    makeHTML5(TEI, callback){\n      // TEI is assumed to be a string\n      let TEI_dom = ( new window.DOMParser() ).parseFromString(TEI, \"text/xml\");\n\n      this._fromTEI(TEI_dom);\n\n      let convertEl = (el) => {\n          // Create new element. TEI elements get prefixed with 'tei-',\n          // TEI example elements with 'teieg-'. All others keep\n          // their namespaces and are copied as-is.\n          let newElement;\n          let copy = false;\n          switch (el.namespaceURI) {\n            case \"http://www.tei-c.org/ns/1.0\":\n              newElement = document.createElement(\"tei-\" + el.tagName);\n              break;\n            case \"http://www.tei-c.org/ns/Examples\":\n              if (el.tagName == \"egXML\") {\n                newElement = document.createElement(\"teieg-\" + el.tagName);\n                break;\n              }\n            default:\n              newElement = document.importNode(el, false);\n              copy = true;\n          }\n          // Copy attributes; @xmlns, @xml:id, @xml:lang, and\n          // @rendition get special handling.\n          for (let att of Array.from(el.attributes)) {\n              if (att.name != \"xmlns\" || copy) {\n                newElement.setAttribute(att.name, att.value);\n              } else {\n                newElement.setAttribute(\"data-xmlns\", att.value); //Strip default namespaces, but hang on to the values\n              }\n              if (att.name == \"xml:id\" && !copy) {\n                newElement.setAttribute(\"id\", att.value);\n              }\n              if (att.name == \"xml:lang\" && !copy) {\n                newElement.setAttribute(\"lang\", att.value);\n              }\n              if (att.name == \"rendition\") {\n                newElement.setAttribute(\"class\", att.value.replace(/#/g, \"\"));\n              }\n          }\n          for (let node of Array.from(el.childNodes)){\n              if (node.nodeType == Node.ELEMENT_NODE) {\n                  newElement.appendChild(  convertEl(node)  );\n              }\n              else {\n                  newElement.appendChild(node.cloneNode());\n              }\n          }\n          // Turn <rendition scheme=\"css\"> elements into HTML styles\n          if (el.localName == \"tagsDecl\") {\n            let style = document.createElement(\"style\");\n            for (let node of Array.from(el.childNodes)){\n              if (node.nodeType == Node.ELEMENT_NODE && node.localName == \"rendition\" && node.getAttribute(\"scheme\") == \"css\") {\n                let rule = \"\";\n                if (node.hasAttribute(\"selector\")) {\n                  //rewrite element names in selectors\n                  rule += node.getAttribute(\"selector\").replace(/([^#, >]+\\w*)/g, \"tei-$1\").replace(/#tei-/g, \"#\") + \"{\\n\";\n                  rule += node.textContent;\n                } else {\n                  rule += \".\" + node.getAttribute(\"xml:id\") + \"{\\n\";\n                  rule += node.textContent;\n                }\n                rule += \"\\n}\\n\";\n                style.appendChild(document.createTextNode(rule));\n              }\n            }\n            if (style.childNodes.length > 0) {\n              newElement.appendChild(style);\n              this.hasStyle = true;\n            }\n          }\n          // Get prefix definitions\n          if (el.localName == \"prefixDef\") {\n            this.prefixes.push(el.getAttribute(\"ident\"));\n            this.prefixes[el.getAttribute(\"ident\")] =\n              {\"matchPattern\": el.getAttribute(\"matchPattern\"),\n              \"replacementPattern\": el.getAttribute(\"replacementPattern\")};\n          }\n          return newElement;\n      }\n\n      this.dom = convertEl(TEI_dom.documentElement);\n\n      if (document.registerElement) {\n        this.registerAll(this.els);\n      } else {\n        this.fallback(this.els);\n      }\n\n      if (callback) {\n          callback(this.dom, this);\n      }\n      else {\n          return this.dom;\n      }\n    }\n\n    /* If the TEI document defines CSS styles in its tagsDecl, this method\n       copies them into the wrapper HTML document's head.\n     */\n    addStyle(doc, data) {\n      if (this.hasStyle) {\n        doc.getElementsByTagName(\"head\").item(0).appendChild(data.getElementsByTagName(\"style\").item(0).cloneNode(true));\n      }\n    }\n\n    /* Add a user-defined set of behaviors to CETEIcean's processing\n       workflow. Added behaviors will override predefined behaviors with the\n       same name.\n    */\n    addBehaviors(bhvs){\n      if (bhvs[\"handlers\"] || bhvs [\"fallbacks\"]) {\n        this.behaviors.push(bhvs);\n      } else {\n        console.log(\"No handlers or fallback methods found.\");\n      }\n    }\n\n    /* Sets the base URL for the document. Used to rewrite relative links in the\n       XML source (which may be in a completely different location from the HTML\n       wrapper).\n     */\n    setBaseUrl(base) {\n      this.base = base;\n    }\n\n    // \"private\" method\n    _fromTEI(TEI_dom) {\n        let root_el = TEI_dom.documentElement;\n        this.els = new Set( Array.from(root_el.getElementsByTagName(\"*\"), x => x.tagName) );\n        this.els.add(root_el.tagName); // Add the root element to the array\n    }\n\n    // private method\n    _insert(elt, strings) {\n      if (elt.createShadowRoot) {\n        let shadow = elt.createShadowRoot();\n        shadow.innerHTML = strings[0] + elt.innerHTML + (strings[1]?strings[1]:\"\");\n      } else {\n        let span;\n        if (strings.length > 1) {\n          if (strings[0].includes(\"<\") && strings[1].includes(\"</\")) {\n            elt.innerHTML = strings[0] + elt.innerHTML + strings[1];\n          } else {\n            elt.innerHTML = \"<span>\" + strings[0] + \"</span>\" + elt.innerHTML + \"<span>\" + strings[1] + \"</span>\";\n          }\n        } else {\n          if (strings[0].includes(\"<\")) {\n            elt.innerHTML = strings[0] + elt.innerHTML;\n          } else {\n            elt.innerHTML = \"<span>\" + strings[0] + \"</span>\" + elt.innerHTML;\n          }\n        }\n      }\n    }\n\n    // private method\n    _template(str, elt) {\n      let result = str;\n      if (str.search(/$(\\w*)@(\\w+)/)) {\n        let re = /\\$(\\w*)@(\\w+)/g;\n        let replacements;\n        while (replacements = re.exec(str)) {\n          if (elt.hasAttribute(replacements[2])) {\n            if (replacements[1] && this[replacements[1]]) {\n              result = result.replace(replacements[0], this[replacements[1]].call(this, elt.getAttribute(replacements[2])));\n            } else {\n              result = result.replace(replacements[0], elt.getAttribute(replacements[2]));\n            }\n          }\n        }\n      }\n      return result;\n    }\n\n    tagName(name) {\n      if (name == \"egXML\") {\n        return \"teieg-\" + name;\n      } else {\n        return \"tei-\" + name;\n      }\n    }\n\n    /* Takes a template in the form of an array of 1 or 2 strings and\n       returns a closure around a function that can be called as\n       a createdCallback or applied to an individual element.\n\n       Called by the getHandler() and\n    */\n    decorator(strings) {\n      return function() {\n        let ceteicean = this;\n        return function (elt) {\n          let copy = [];\n          if (this != ceteicean) {\n            elt = this;\n          }\n          for (let i = 0; i < strings.length; i++) {\n            copy.push(ceteicean._template(strings[i], elt));\n          }\n          ceteicean._insert(elt, copy);\n        }\n      }\n    }\n\n    /* Returns the handler function for the given element name\n\n       Called by registerAll().\n     */\n    getHandler(fn) {\n      for (let i = this.behaviors.length - 1; i >= 0; i--) {\n        if (this.behaviors[i][\"handlers\"][fn]) {\n          if (Array.isArray(this.behaviors[i][\"handlers\"][fn])) {\n            return this.decorator(this.behaviors[i][\"handlers\"][fn]);\n          } else {\n            return this.behaviors[i][\"handlers\"][fn];\n          }\n        }\n      }\n    }\n\n    /* Returns the fallback function for the given element name.\n\n       Called by fallback().\n     */\n    getFallback(fn) {\n      for (let i = this.behaviors.length - 1; i >= 0; i--) {\n        if (this.behaviors[i][\"fallbacks\"][fn]) {\n          if (Array.isArray(this.behaviors[i][\"fallbacks\"][fn])) {\n            return this.decorator(this.behaviors[i][\"fallbacks\"][fn]).call(this);\n          } else {\n            return this.behaviors[i][\"fallbacks\"][fn];\n          }\n        } else if (this.behaviors[i][\"handlers\"][fn] && Array.isArray(this.behaviors[i][\"handlers\"][fn])) {\n          // if there's a handler template, we can construct a fallback function\n          return this.decorator(this.behaviors[i][\"handlers\"][fn]).call(this);\n        } else if (this.behaviors[i][\"handlers\"][fn] && this.behaviors[i][\"handlers\"][fn].call(this).length == 1) {\n          return this.behaviors[i][\"handlers\"][fn].call(this);\n        }\n      }\n    }\n\n    /* Registers the list of elements provided with the browser.\n\n       Called by makeHTML5(), but can be called independently if, for example,\n       you've created Custom Elements via an XSLT transformation instead.\n     */\n    registerAll(names) {\n      for (let name of names) {\n        let proto = Object.create(HTMLElement.prototype);\n        let fn = this.getHandler(name);\n        if (fn) {\n          proto.createdCallback = fn.call(this);\n        }\n        let prefixedName = this.tagName(name);\n        try {\n          document.registerElement(prefixedName, {prototype: proto});\n        } catch (error) {\n          console.log(prefixedName + \" couldn't be registered or is already registered.\");\n          console.log(error);\n        }\n\n      }\n    }\n\n    /* Provides fallback functionality for browsers where Custom Elements\n       are not supported.\n\n       Like registerAll(), this is called by makeHTML5(), but can be called\n       independently.\n    */\n    fallback(names) {\n      for (let name of names) {\n        let fn = this.getFallback(name);\n        if (fn) {\n          for (let elt of Array.from(this.dom.getElementsByTagName(this.tagName(name)))) {\n            fn.call(this, elt);\n          }\n\n        }\n      }\n    }\n\n    /**********************\n     * Utility functions  *\n     **********************/\n\n    /* Takes a relative URL and rewrites it based on the base URL of the\n       HTML document */\n    rw(url) {\n      if (!url.match(/^(?:http|mailto|file|\\/).*$/)) {\n        return this.base + url;\n      } else {\n        return url;\n      }\n    }\n\n    /* Given a space-separated list of URLs (e.g. in a ref with multiple\n       targets), returns just the first one.\n     */\n    first(urls) {\n      return urls.replace(/ .*$/, \"\");\n    }\n\n    // public method\n    fromODD(){\n        // Place holder for ODD-driven setup.\n        // For example:\n        // Create table of elements from ODD\n        //    * default HTML behaviour mapping on/off (eg tei:div to html:div)\n        //    ** phrase level elements behave like span (can I tell this from ODD classes?)\n        //    * optional custom behaviour mapping\n    }\n\n\n\n}\n\n// Make main class available to pre-ES6 browser environments\n// if (window) {\n//     window.CETEI = CETEI;\n// }\nexport default CETEI;\n"],"sourceRoot":"/source/"}