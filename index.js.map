{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["var express = require('express');\nvar graph = require('fbgraph');\nvar app = express();\nvar path = require(\"path\");\nvar html = require(\"html\");\n\nvar sync = require('synchronize');\n\nvar Promise = require('es6-promise').Promise;\n\n\n\nvar data = [];\n\nvar lastPostTime = \"\";\nvar sourceLastPostTimes = {};\n\nvar oldestTweetIds = {};\n\n\nvar title = require(\"./titles.js\");\nvar twitter = require(\"./twitterModule.js\")\nvar database = require(\"./pgdatabase.js\")\n\n//\n\napp.use(express.static(__dirname + '/domainParserviews'));\n//Store all HTML files in view folder.\napp.use(express.static(__dirname + '/views'));\n//Store all JS and CSS in Scripts folder.\n\napp.engine('.html', require('ejs').renderFile);\n\ngraph.setAccessToken(\"579108942256325|cVDQ9owJoESqH8IwNBDZfbxcqSI\");\n\n// app.get('/', function (req, res) {\n//   res.send('Hello World to the world!');\n// });\nvar intervalCounter = 0;\nasync function main(){\n\n  var results = await database.getPosts();\n  console.log(JSON.stringify(results));\n  await updateData();\n  await updateProductData();\n  setInterval(async function() {\n    try {\n      console.log(\"========= Interval: \"+(intervalCounter++)+\" ===========\");\n      await updateData();\n\n      await updateProductData();\n      console.log(\"Finished interval \");\n    } catch (e){\n      console.log(e);\n    }\n    //Update Torrent Data\n  }, 100000);\n}\nmain();\n\nasync function updateProductData(){\n\n  try {\n    if ( data ){\n\n      for ( var d in data) {\n        var link = data[d].link;\n        if ( link ){\n          if ( (!data[d].torrent) || data[d].torrent.totalSeeds < 1){\n\n            var t = await title.getProductInformation(link);\n            //console.log(t);\n            data[d].torrent = t ;\n\n\n          }\n        }\n      }\n    }\n  } catch (e) {\n    console.log(e);\n  }\n}\n\n\nfunction getProductTitleFromText(text){\n  if ( !text ){\n    return \"\";\n  }\n  var textExt = text.match(/^([A-z\\s]+(?:\\d{1,4}|\\(\\d{1,4}\\))?)/gm);\n  if ( textExt !== null){\n    if ( textExt[0] && textExt[0].length > 3 ){\n      return textExt[0];\n    }\n  }\n  return \"\";\n}\n\napp.get('/',function(req,res){\n  //console.log(\"EPALE!\"+JSON.stringify(req));\n  res.render('index.html', { data: \"\" });\n  //__dirname : It will resolve to your project folder.\n});\n\n\n\n//\n// app.get('/about',function(req,res){\n//    res.render('about.html', {title: 'About'});\n//    //res.sendFile('/about.html');\n// });\n//\n// app.get('/sitemap',function(req,res){\n//   res.render('sitemap.html', {title: 'Sitemap'});\n// });\n\napp.get('/')\n\n\napp.get('/data',function(req,res){\n  try {\n    console.log(\"Sending \"+data.length+\" records\");\n\n\n    res.send(data);\n    //  updateData();\n\n  } catch( ex){\n    console.log(ex);\n    res.send(\"\");\n  }\n  //__dirname : It will resolve to your project folder.\n});\n\napp.listen(3000, function () {\n  console.log('IPWatchr Running on port 3000 ' + new Date().toISOString());\n});\n\nvar options = {\n  timeout:  3000\n  , pool:     { maxSockets:  Infinity }\n  , headers:  { connection:  \"keep-alive\" }\n};\n\n\nasync function updateData(){\n  return new Promise( async function (Resolve,Reject){\n    console.log(\"reading data : \"+ new Date().toISOString());\n //allbluraymovies1080p\n    var seeds = [\"gamesmegatorrents\",\"MoviesNowFullHD1080PTorrents\"\n                ,\"moviedetector\",\"gamesfullbyalex\"\n                ,\"filmesejogostorrent\",\"TorrentPool\",\"113535202057659\"\n                ,\"244734628952818\",\"game4tm\",\"915572561850431\",\"139779569497933\"\n                ,\"GamesFullExtreme\",\"1436776693287197\",\"976253959105677\"];\n\n    //data = [];\n    //,\"@OmerGet4Games\"\n    var twitter_seeds = [\"@OmegaPirata\",\"@YTSDirect\",\"@TorrentsYify\"\n                        ,\"@is_torrent\",\"@snake_torrent\"\n                        ,\"@flltrentoynindr\"];\n\n    try {\n\n      // here we'll look for new tweets\n\n\n      for ( var s in twitter_seeds){\n        var seedAccount = twitter_seeds[s];\n        try {\n          var max_id = oldestTweetIds[seedAccount];\n          var tweets = (await twitter.twSearch(seedAccount,max_id));\n          //  console.log(tweets);\n\n          if ( tweets ){\n            var newData = formatTweetData(tweets,seedAccount);\n\n            data = data.concat(newData);\n            console.log(\"ADDED \"+newData.length+\" Tweets\");\n          }\n        }catch (e ){\n          console.log(e);\n        }\n      }\n\n      //\n      // console.log(sourceLastPostTimes);\n      //This bit searches for new FB posts\n      for ( var s in seeds){\n        var seedAccount = seeds[s];\n\n\n          var query  = prepareFBQuery(seedAccount,true)\n          var newData = await getFBData(seedAccount,query);\n          data = data.concat(newData);\n\n          console.log(\"read: \"+seedAccount+\" dataSize: \"+data.length);\n      }\n\n      // This other bit goes back in time to the old FB posts.\n      for ( var s in seeds){\n        var seedAccount = seeds[s];\n          var query  = prepareFBQuery(seedAccount)\n          var newData = await getFBData(seedAccount,query);\n          data = data.concat(newData);\n\n          console.log(\"read backwards: \"+seedAccount+\" dataSize: \"+data.length);\n      }\n\n\n    }catch (e){\n      console.log(e);\n      Reject(false);\n    }\n    var sortedData = data.sort(function(a, b) {\n      return new Date(b.created_time) - new Date(a.created_time);\n    });\n\n    data = sortedData;\n\n    lastPostTime = data[data.length-1].created_time;\n    //return data;\n    Resolve(true);\n  });\n}\n\nprocess.on('uncaughtException', function (exception) {\n  console.log(exception); // to see your exception details in the console\n  // if you are on production, maybe you can send the exception details to your\n  // email as well ?\n});\n\nfunction formatTweetData(tweets,seedAccount){\n  var dataSegment =[];\n  for ( var t in tweets){\n    var tw_post = tweets[t];\n    var link = getUrl(tw_post.text);\n\n    //if ( t === undefined){\n\n    //var t= {  totalSeeds : 0 , totalPeers : 0, totalDownloads : 0};\n    if ( oldestTweetIds[seedAccount] ){\n\n      oldestTweetIds[seedAccount] = (oldestTweetIds[seedAccount] > tw_post.id) ? tw_post.id : oldestTweetIds[seedAccount];\n    } else {\n\n      oldestTweetIds[seedAccount] = tw_post.id;\n    }\n\n    var post = {\n      \"seed\": seedAccount,\n      \"message\": tw_post.text,\n      \"postid\": tw_post.id_str,\n      \"created_time\": new Date(tw_post.created_at).toISOString(),\n      \"link\": link,\n      \"likes_count\": tw_post.retweet_count,\n      \"likes\" : {},\n      \"torrent\": undefined,\n      \"sourceType\": \"TW\",\n      \"productTitle\" : getProductTitleFromText(tw_post.text)\n    };\n\n    if ( isDuplicate(tw_post.created_at,tw_post.message)){\n      continue;\n    }\n    //  }\n    //  var t = await title.getProductInformation(link);\n\n    dataSegment.push(post);\n  }\n  return dataSegment;\n}\n\nfunction isDuplicate(created_time,message){\n  var duplicate = false;\n  for ( var d in data ){\n    if ((data[d].created_time === created_time) || (data[d].message === message )){\n      //  console.log(\"FOUND DUPLICATEE!!!!!\");\n      return true;\n    }\n  }\n  return false;\n}\n\nfunction prepareFBQuery(seedAccount, forward){\n  var limitTime = \"\";\n  lastPostTime = sourceLastPostTimes[seedAccount];\n  if ( lastPostTime === undefined || forward){\n    limitTime = \"now\";\n  }else {\n    limitTime = lastPostTime.substring(0, lastPostTime.length-5);\n  }\n  var FBQuery = seedAccount+\"?fields=posts.limit(10).until(\"+limitTime+\"){message,likes,created_time,link}\";\n  return FBQuery;\n}\n\nasync function getFBData(seedAccount,FBQuery){\n\n\n  return new Promise( function (Resolve,Reject){\n\n    try{\n      //  var FBQuery = seedAccount+\"?fields=posts.limit(10){message,likes,created_time,link}\";\n      var dataSegment =[];\n\n      console.log(\"Querying FB: \"+FBQuery);\n      graph.setOptions(options)\n      .get(FBQuery, async function(err, res) {\n        try {\n          if ( res == null){\n            console.log(err);\n            return;\n          }\n          console.log( res.posts.data.length);\n          for (var p in res.posts.data){\n\n            var post = res.posts.data[p];\n            var link = \"\";\n\n            var likes = null;\n            var likes_count = 0;\n\n            if ( post.likes ){\n              if ( post.likes.data != undefined){\n                likes = post.likes.data;\n                likes_count = likes.length;\n              }\n            }\n\n            link = getUrl(post.message);\n\n            if ( isDuplicate(post.created_time,post.message)){\n              continue;\n            }\n\n            //  var t = await title.getProductInformation(link);\n          //  var t= {  totalSeeds : 0 , totalPeers : 0, totalDownloads : 0};\n            //  console.log(t +\"<< UNDEFIE\");\n            // if ( t === undefined){\n            //   t = {  totalSeeds : 0 , totalPeers : 0, totalDownloads : 0};\n            // }\n\n            //console.log(t);\n            //  console.log(post.message);\n            dataSegment.push({\n              \"seed\": seedAccount,\n              \"message\": post.message,\n              \"postid\": post.id,\n              \"created_time\": new Date(post.created_time).toISOString(),\n              \"link\": link,\n              \"likes_count\": likes_count,\n              \"likes\" : likes,\n              \"torrent\": undefined,\n              \"sourceType\": \"FB\",\n              \"productTitle\" : getProductTitleFromText(post.message)\n            });\n\n\n\n\n          }\n\n          if ( sourceLastPostTimes[seedAccount] ){\n            sourceLastPostTimes[seedAccount] = new Date(post.created_time) < new Date(sourceLastPostTimes[seedAccount]) ? post.created_time : sourceLastPostTimes[seedAccount];\n          } else {\n            sourceLastPostTimes[seedAccount] = post.created_time;\n          }\n          console.log(\"Finished Querying FB: \"+FBQuery);\n          Resolve(dataSegment);\n          //console.log(lastPostTime);\n        } catch (e) {\n          Reject(\"fail: \"+e);\n          console.log(e);\n        }\n\n        // var sortedData = data.sort(function(a, b) {\n        //       return new Date(b.created_time) - new Date(a.created_time);\n        // });\n      });\n\n    } catch (err){\n      console.log(err);\n      Reject(false);\n    }\n  });\n\n\n}\n\n\n\n\nfunction getUrl(message){\n  if ( message == undefined) {return \"\"};\n  var expression = /[-a-zA-Z0-9@:%_\\+.~#?&//=]{2,256}\\.[a-z]{2,4}\\b(\\/[-a-zA-Z0-9@:%_\\+.~#?&//=]*)?/gi;\n  var regex = new RegExp(expression);\n  var t = message;\n\n  var result = t.match(regex);\n  if (result)\n  {\n    return result[0].toString();\n  } else {\n    return \"\";\n  }\n}\n\n\n\n//getTorrentData('Chinese Zodiac (2012) 1080p BluRay x264 [Dual Audio] [Hindi DD 2.0 - English] - monu987').then(console.log(r));\n//console.log(getTorrentData('Chinese Zodiac (2012) 1080p BluRay x264 [Dual Audio] [Hindi DD 2.0 - English] - monu987'));\n"],"sourceRoot":"/source/"}